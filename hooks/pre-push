#!/bin/sh

# Pre-push Hook
# 
# This hook runs before code is pushed to the remote repository. It performs
# a build gate check to ensure that:
# 1. Dependencies are installed correctly (npm ci)
# 2. The project builds successfully (npm run build)
#
# If either step fails, the push is blocked and the error output is displayed.
# This prevents broken code from being pushed to the repository.
#
# To install this hook, run:
#   cp hooks/pre-push .git/hooks/pre-push
#   chmod +x .git/hooks/pre-push
#
# Or use git config to set the hooks path:
#   git config core.hooksPath hooks

echo "Running build gate: npm ci && npm run build"

OUTPUT=$(npm ci && npm run build 2>&1)
STATUS=$?

if [ $STATUS -ne 0 ]; then
  echo ""
  echo "Build failed. Errors:"
  echo "----------------------------------------"
  echo "$OUTPUT"
  echo "----------------------------------------"
  exit $STATUS
fi

echo "Build passed"
